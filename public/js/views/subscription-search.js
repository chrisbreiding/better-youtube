// Generated by CoffeeScript 1.4.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['backbone', 'handlebars', 'models/subscription-search-result', 'views/subscription-search-result', 'text!templates/subscription-search.html', 'modules/youtube'], function(Backbone, Handlebars, SubscriptionSearchResultModel, SubscriptionSearchResultView, subSearchTemplate, youtube) {
    var SubscriptionSearchView;
    return SubscriptionSearchView = (function(_super) {

      __extends(SubscriptionSearchView, _super);

      function SubscriptionSearchView() {
        this.addSubSearchResult = __bind(this.addSubSearchResult, this);

        this.showSubResults = __bind(this.showSubResults, this);
        return SubscriptionSearchView.__super__.constructor.apply(this, arguments);
      }

      SubscriptionSearchView.prototype.el = '#subscription-search-region';

      SubscriptionSearchView.prototype.events = {
        'click #new-subscription': 'showSubSearch',
        'submit #sub-search-form': 'searchSubs',
        'click #search-subs': 'searchSubs'
      };

      SubscriptionSearchView.prototype.showSubSearch = function(e) {
        e.preventDefault();
        $('#subscription-search-region').append(subSearchTemplate);
        return $('#sub-query').focus();
      };

      SubscriptionSearchView.prototype.searchSubs = function(e) {
        var query;
        e.preventDefault();
        query = $('#sub-query').val();
        return youtube.searchSubs(query).done(this.showSubResults);
      };

      SubscriptionSearchView.prototype.showSubResults = function(results) {
        this.clearSubResults();
        return _.each(results.feed.entry, this.addSubSearchResult);
      };

      SubscriptionSearchView.prototype.clearSubResults = function() {
        return $('#subscription-search-results').html('');
      };

      SubscriptionSearchView.prototype.addSubSearchResult = function(entry) {
        var model, view;
        model = new SubscriptionSearchResultModel(this.mapDetails(entry));
        view = new SubscriptionSearchResultView({
          model: model
        });
        return $('#subscription-search-results').append(view.render().el);
      };

      SubscriptionSearchView.prototype.mapDetails = function(entry) {
        return {
          channelId: entry.yt$channelId.$t,
          title: entry.title.$t,
          author: entry.author[0].name.$t,
          thumb: entry.media$thumbnail[0].url
        };
      };

      return SubscriptionSearchView;

    })(Backbone.View);
  });

}).call(this);
